<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="时光静好，岁月无言，我�以笔墨初心，粉饰年华，告慰光阴。"><title>记录一道xss题目以及涉及的知识点(1) | Iambangbang 的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">记录一道xss题目以及涉及的知识点(1)</h1><a id="logo" href="/.">Iambangbang 的博客</a><p class="description">喜欢web和写诗</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">记录一道xss题目以及涉及的知识点(1)</h1><div class="post-meta">Oct 6, 2017</div><div class="post-content"><hr>
<h3 id="写在开头"><a href="#写在开头" class="headerlink" title="写在开头"></a>写在开头</h3><p>这道题目一开始见得时候知道是xss，也是尝试了很多，但最多完成第一步，第二步也是想不出来，后来在Bendawang的指导下，学了不少东西，在本地搭了一个测试的环境，然后真正意义上把这道题做了出来(ps:这道题在汪神的平台上有，题目名称就不说了，就一道xss题)</p>
<h3 id="内容安全策略（Content-Security-Policy）"><a href="#内容安全策略（Content-Security-Policy）" class="headerlink" title="内容安全策略（Content Security Policy）"></a>内容安全策略（Content Security Policy）</h3><h4 id="CSP简单介绍"><a href="#CSP简单介绍" class="headerlink" title="CSP简单介绍"></a>CSP简单介绍</h4><p>Content Security Policy (CSP) is an added layer of security that helps to detect and mitigate certain types of attacks, including Cross Site Scripting (XSS) and data injection attacks. These attacks are used for everything from data theft to site defacement or distribution of malware.（这是官方给出的解释，翻译过来的大意就是，这是一个附加的安全策略，这个策略是用来检测并减轻某些类型的攻击，包括xss和数据注入的攻击，说白了就是过滤了一些不合理的访问。ps：下面会介绍）</p>
<h4 id="如何使用CSP"><a href="#如何使用CSP" class="headerlink" title="如何使用CSP"></a>如何使用CSP</h4><p>csp被称为安全策略不是没有原因的，因为他是从来源上严格限制了js等可能发生攻击的代码，csp有两种方法可以启用。</p>
<h5 id="http头信息"><a href="#http头信息" class="headerlink" title="http头信息"></a>http头信息</h5><p>通过http头信息Content-Security-Policy的字段启用csp，如下：<br><img src="/2017/10/06/xss1/001.png" alt=""></p>
<h5 id="通过网页的-lt-meta-gt-标签"><a href="#通过网页的-lt-meta-gt-标签" class="headerlink" title="通过网页的&lt;meta&gt;标签"></a>通过网页的&lt;meta&gt;标签</h5><p>通过网页的&lt;meta&gt;标签启用csp，如下：<br><img src="/2017/10/06/xss1/002.png" alt=""><br>图片中涉及到的一些配置信息，在后面的内容中会提及到。如果在访问网页的时候所加载的外部资源如果不符合CSP就会被阻止加载，同时浏览器会报错。</p>
<h4 id="CSP配置信息"><a href="#CSP配置信息" class="headerlink" title="CSP配置信息"></a>CSP配置信息</h4><p>csp提供了很多的限制选项，涉及到安全的很多方面，如下：</p>
<h5 id="资源加载限制"><a href="#资源加载限制" class="headerlink" title="资源加载限制"></a>资源加载限制</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">script-src：外部脚本</div><div class="line">style-src：样式表</div><div class="line">img-src：图像</div><div class="line">media-src：媒体文件（音乐和视频）</div><div class="line">font-src：字体文件</div><div class="line">object-src：插件（比如Flash）</div><div class="line">child-src：框架</div><div class="line">frame-ancestors：嵌入的外部资源(比如&lt;frame&gt;&lt;iframe&gt;&lt;embed&gt;&lt;applet&gt;)</div><div class="line">connect-src：HTTP连接（通过XHR、WebSockets、EventSource等）</div><div class="line">worker-src：worker脚本</div><div class="line">manifest-src：manifest文件</div></pre></td></tr></table></figure>
<h5 id="default-src"><a href="#default-src" class="headerlink" title="default-src"></a>default-src</h5><p>default-src是用来设置上面所提到的各个项的默认值，语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Content-Security-Policy：default-src &lt;source&gt;;</div><div class="line">Content-Security-Policy：default-src &lt;source&gt; &lt;source&gt;;</div></pre></td></tr></table></figure></p>
<p>这里的&lt;source&gt;可以是一下之一：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">1　&lt;host-source&gt;:</div><div class="line">以域名或者IP地址表示的主机名，例如：</div><div class="line">http:\/\/*.exmaple.com：匹配从使用http:的example.com的任意子域的资源加载</div><div class="line">http:\/\/mail.store.examples:443：匹配对mail.example.com上的443端口号的访问。</div><div class="line">２　&lt;schema-source&gt;:</div><div class="line">协议名用如&apos;http:&apos;或者&apos;https:&apos;。必须带有冒号，不要有单引号。同时还可以指定数据协议(data schema)：</div><div class="line">data:允许data：URLs作为内容的源。但是，这是不安全的。攻击者可以注入任意的data:URl。</div><div class="line">mediastream：允许mediastream：URls作为内容的源。</div><div class="line">blob：允许blob：URls作为内容的源。</div><div class="line">filesystem：允许filesystem：URls作为内容的源。</div><div class="line">３　&apos;self&apos;</div><div class="line">指向与要保护的文件所在的源，包括相同的URL_schema与端口号。必须有单引号。一些浏览器会特意排除blob与filesystem。需要设定这两种内容类型的站点可以在Data属性中进行设定。</div><div class="line">４　&apos;unsafe=inline&apos;</div><div class="line">允许使用内联资源，例如内联&lt;script&gt;元素内联时间处理器以及内联&lt;style&gt;元素。必须有单引号。</div><div class="line">５　&apos;unsafe=eval&apos;</div><div class="line">允许使用eval()以及相似的函数来从字符串创建代码。必须有单引号。</div><div class="line">６　&apos;none&apos;</div><div class="line">不允许使用任何内容。必须有单引号。</div><div class="line">７　&apos;nonce-&lt;base64-value&gt;&apos;</div><div class="line">使用加密随机数（一次使用数字）的特定内联脚本的白名单。每次发送策略时，服务器必须生成唯一的值。提供一个不可预测的随机数是至关重要的，因为绕过资源的策略是微不足道的。请参阅不安全的内联脚本作为示例。</div><div class="line">８　&lt;hash-source&gt;</div><div class="line">使用sha256,sha384或sha512编码过的内联脚本或样式。当生成哈希值的时候，不要包含&lt;scipt&gt;或&lt;style&gt;标签，同事注意字母大小写与空格--包括首尾空格--都是会影响生成的结果的。</div><div class="line">９　&apos;strict-dynamic&apos;</div><div class="line">strict-dynamic源表达式明确赋予了在标记中出现的脚本文件以及信任成都，为它指定一个nonce或hash值。该值会被传递给所有由根脚本加载的脚本文件。与此同事，任何白名单以及源表达式例如&apos;self&apos;或者&apos;unsafe-inline&apos;都会被忽略。</div></pre></td></tr></table></figure></p>
<h5 id="URL限制"><a href="#URL限制" class="headerlink" title="URL限制"></a>URL限制</h5><p>有时，网页会跟其他ＵＲＬ发生联系，这时也可以加以限制。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">frame-ancestors:限制嵌入框架的网页</div><div class="line">base-uri:限制&lt;base#href&gt;</div><div class="line">from-action:限制&lt;form#action&gt;</div><div class="line">block-all-mixed-content:HTTPS网页不得加载HTTP资源(浏览器已经默认开启)</div><div class="line">upgrade-insecure-requests:自动将网页上所有加载外部资源的HTTP链接换成HTTPS协议</div><div class="line">plugin-types:限制可以使用的插件格式</div><div class="line">sandbox:浏览器行为的限制，比如不能有弹出窗口等。</div></pre></td></tr></table></figure></p>
<h5 id="report-uri"><a href="#report-uri" class="headerlink" title="report-uri"></a>report-uri</h5><p>很多时候，我们不仅希望防止xss，还希望记录这种行为。report-uri就是用来告诉浏览器，应该吧注入行为报告给那个网址。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Content-Security-Policy: default-src &apos;self&apos;; ...; report-uri /my_amazing_csp_report_parser;</div></pre></td></tr></table></figure></p>
<p>这段代码指定，将注入行为报告给/my_amazing_csp_report_parser这个URL，浏览器会使用POST方法，发送一个JSON对象，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;csp-report&quot;: &#123;</div><div class="line">    &quot;document-uri&quot;: &quot;http://example.org/page.html&quot;,</div><div class="line">    &quot;referrer&quot;: &quot;http://evil.example.com/&quot;,</div><div class="line">    &quot;blocked-uri&quot;: &quot;http://evil.example.com/evil.js&quot;,</div><div class="line">    &quot;violated-directive&quot;: &quot;script-src &apos;self&apos; https://apis.google.com&quot;,</div><div class="line">    &quot;original-policy&quot;: &quot;script-src &apos;self&apos; https://apis.google.com; report-uri http://example.org/my_amazing_csp_report_parser&quot;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="关于CSP的其他一些东西"><a href="#关于CSP的其他一些东西" class="headerlink" title="关于CSP的其他一些东西"></a>关于CSP的其他一些东西</h4><p><a href="http://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="external">阮一峰</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy__by_cnvoid" target="_blank" rel="external">MDN</a><br><a href="https://www.html5rocks.com/en/tutorials/security/content-security-policy/" target="_blank" rel="external">国外大牛</a><br><a href="https://research.google.com/pubs/pub45542.html" target="_blank" rel="external">google</a></p>
</div><div class="tags"></div><div class="post-nav"><a href="/2017/10/06/xss2/" class="pre">记录一道xss题目以及涉及的知识点(2)</a><a href="/2017/09/29/1/" class="next">石光磨坊</a></div><div id="uyan_frame"><script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2145606"></script></div><script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/06/xss2/">记录一道xss题目以及涉及的知识点(2)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/06/xss1/">记录一道xss题目以及涉及的知识点(1)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/1/">石光磨坊</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/28/php-filter/">PHP伪协议简析</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://bendawang.site/" title="Bendawang" target="_blank">Bendawang</a><ul></ul><a href="http://blog.csdn.net/ni9htmar3" title="Ni9htMar3" target="_blank">Ni9htMar3</a><ul></ul><a href="http://blog.csdn.net/qq_31481187/article/category/6419374" title="4ct10n" target="_blank">4ct10n</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Iambangbang 的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://xn--bga.pw:4000"> Iambangbang</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>